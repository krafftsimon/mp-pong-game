webpackJsonp([1],{0:function(t,n,e){t.exports=e("cDNt")},1:function(t,n){},cDNt:function(t,n,e){"use strict";function i(t){return o._18(0,[o._15(402653184,1,{canvas:0}),(t()(),o._3(0,null,null,1,"h1",[],null,null,null,null,null)),(t()(),o._17(null,[" You are in room ",", and are player ",""])),(t()(),o._17(null,["\n"])),(t()(),o._3(0,null,null,1,"h1",[],null,null,null,null,null)),(t()(),o._17(null,[" pending inputs:"," "])),(t()(),o._17(null,["\n"])),(t()(),o._3(0,null,null,1,"h1",[],null,null,null,null,null)),(t()(),o._17(null,[" input Number:"," "])),(t()(),o._17(null,["\n"])),(t()(),o._3(0,[[1,0],["gameCanvas",1]],null,0,"canvas",[["height","600"],["width","800"]],null,null,null,null,null)),(t()(),o._17(null,["\n"]))],null,function(t,n){var e=n.component;t(n,2,0,e.roomNum,e.clientPlayerNum),t(n,5,0,e.pendingInputs.length),t(n,8,0,e.inputNumber)})}function s(t){return o._18(0,[(t()(),o._3(0,null,null,1,"app-root",[],null,[["window","keydown"],["window","keyup"]],function(t,n,e){var i=!0;if("window:keydown"===n){i=!1!==o._14(t,1).keyUp(e)&&i}if("window:keyup"===n){i=!1!==o._14(t,1).keyDown(e)&&i}return i},i,m)),o._1(114688,null,0,y,[h],null,null)],function(t,n){t(n,1,0)},null)}Object.defineProperty(n,"__esModule",{value:!0});var o=e("/oeL"),u={production:!0},r=function(){function t(){}return t}(),l=e("bKpL"),p=e("MjLF"),h=function(){function t(){this.devUrl="http://localhost:4400",this.prodUrl="http://35.193.240.128:4400",this.url=this.devUrl}return t.prototype.connect=function(){var t=this;return new l.Observable(function(n){t.socket=p(t.url),t.socket.on("connectToRoom",function(t){n.next(t)})})},t.prototype.getPlayerNumber=function(){var t=this;return new l.Observable(function(n){t.socket.on("playerNumber",function(t){n.next(t)})})},t.prototype.sendUserInput=function(t){this.socket.emit("userInput",t)},t.prototype.getState=function(){var t=this;return new l.Observable(function(n){t.socket.on("gameState",function(t){n.next(t)})})},t}(),a=function(){function t(t){this.y=250,this.speed=10,this.positionBuffer=[],this.x=t}return t.prototype.applyInput=function(t){this.y+=t.direction*this.speed,this.y>500?this.y=500:this.y<0&&(this.y=0)},t}(),c=function(){function t(){this.x=20,this.y=20,this.xSpeed=5,this.ySpeed=5,this.positionBuffer=[]}return t.prototype.move=function(t,n){this.x+=this.xSpeed,this.y+=this.ySpeed,this.y>595&&(this.ySpeed=-this.ySpeed),this.x>795&&(this.xSpeed=-this.xSpeed),this.y<5&&(this.ySpeed=-this.ySpeed),this.x<5&&(this.x=400,this.y=250),this.x<=45&&this.x>=40&&this.y+5>=t.y&&this.y-5<=t.y+100||this.x>=755&&this.x<=760&&this.y+5>=n.y&&this.y-5<=n.y+100?this.xSpeed=-this.xSpeed:(this.x>=20&&this.x<=40&&this.y+5>=t.y&&this.y<=t.y+10||this.x>=20&&this.x<=40&&this.y-5<=t.y+100&&this.y>=t.y+90||this.x>=760&&this.x<=780&&this.y+5>=n.y&&this.y<=n.y+10||this.x>=760&&this.x<=780&&this.y-5<=n.y+100&&this.y>=n.y+90)&&(this.ySpeed=-this.ySpeed)},t}(),y=function(){function t(t){this.gameService=t,this.updateRate=50,this.direction=0,this.interpolationInputs=[],this.pendingInputs=[],this.ballSteps=[],this.inputNumber=0,this.player1=new a(20),this.player2=new a(760),this.ball=new c}return t.prototype.keyUp=function(t){38===t.keyCode?this.direction=-1:40===t.keyCode&&(this.direction=1)},t.prototype.keyDown=function(t){38===t.keyCode?this.direction=0:40===t.keyCode&&(this.direction=0)},t.prototype.ngOnInit=function(){var t=this;this.gameService.connect().subscribe(function(n){return t.roomNum=n},function(t){return console.log(t)},function(){return console.log("Completed.")}),this.gameService.getPlayerNumber().subscribe(function(n){return t.clientPlayerNum=n},function(t){return console.log(t)},function(){return console.log("Completed.")}),this.subscribeToServer(),this.setUpdateRate(this.updateRate)},t.prototype.setUpdateRate=function(t){clearInterval(this.updateInterval),this.updateInterval=setInterval(function(t){return function(){t.updateGame()}}(this),1e3/t)},t.prototype.updateGame=function(){this.processServerData(),this.processUserInputs(),this.interpolate(),this.drawCanvas()},t.prototype.subscribeToServer=function(){var t=this;this.gameService.getState().subscribe(function(n){return t.gameState=n[t.roomNum-1]},function(t){return console.log(t)},function(){return console.log("Completed.")})},t.prototype.processServerData=function(){if(1===this.clientPlayerNum){this.player1.y=this.gameState.player1.y,this.interpolationInputs=this.gameState.inputsP2;for(var t=0;t<this.pendingInputs.length;)this.pendingInputs[t].inputNumber<=this.gameState.lastProcessedInputP1?this.pendingInputs.splice(t,1):(this.player1.applyInput(this.pendingInputs[t]),t++)}else if(2===this.clientPlayerNum){this.player2.y=this.gameState.player2.y,this.interpolationInputs=this.gameState.inputsP1;for(var t=0;t<this.pendingInputs.length;)this.pendingInputs[t].inputNumber<=this.gameState.lastProcessedInputP2?this.pendingInputs.splice(t,1):(this.player2.applyInput(this.pendingInputs[t]),t++)}this.ballSteps=this.gameState.ballSteps},t.prototype.processUserInputs=function(){if(0!==this.direction){var t={direction:this.direction,inputNumber:this.inputNumber++,playerNum:this.clientPlayerNum,roomNum:this.roomNum};void 0!==this.roomNum&&this.gameService.sendUserInput(t),1===this.clientPlayerNum?(this.player1.applyInput(t),this.pendingInputs.push(t)):(this.player2.applyInput(t),this.pendingInputs.push(t))}},t.prototype.interpolate=function(){this.ballSteps.length>0&&(this.ball.x=this.ballSteps[0].x,this.ball.y=this.ballSteps[0].y,this.ballSteps.shift()),this.interpolationInputs.length>0&&(1===this.clientPlayerNum?(this.player2.applyInput(this.interpolationInputs[0]),this.interpolationInputs.shift()):2===this.clientPlayerNum&&(this.player1.applyInput(this.interpolationInputs[0]),this.interpolationInputs.shift()))},t.prototype.drawCanvas=function(){var t=this.canvas.nativeElement.getContext("2d");t.clearRect(0,0,800,600),t.beginPath(),t.rect(this.player1.x,this.player1.y,20,100),t.rect(this.player2.x,this.player2.y,20,100),t.stroke(),t.beginPath(),t.arc(this.ball.x,this.ball.y,5,0,2*Math.PI),t.stroke()},t.ctorParameters=function(){return[{type:h}]},t}(),d=["canvas[_ngcontent-%COMP%]{border:1px solid red;margin:40px auto;display:block}"],f=[d],m=o._0({encapsulation:0,styles:f,data:{}}),b=o.Y("app-root",y,s,{},{},[]),_=e("qbdv"),g=e("fc+i"),v=o.Z(r,[y],function(t){return o._12([o._13(512,o.i,o.W,[[8,[b]],[3,o.i],o.x]),o._13(5120,o.v,o._11,[[3,o.v]]),o._13(4608,_.d,_.c,[o.v]),o._13(4608,o.h,o.h,[]),o._13(5120,o.a,o._4,[]),o._13(5120,o.t,o._9,[]),o._13(5120,o.u,o._10,[]),o._13(4608,g.b,g.s,[_.b]),o._13(6144,o.H,null,[g.b]),o._13(4608,g.e,g.f,[]),o._13(5120,g.c,function(t,n,e,i){return[new g.k(t),new g.o(n),new g.n(e,i)]},[_.b,_.b,_.b,g.e]),o._13(4608,g.d,g.d,[g.c,o.z]),o._13(135680,g.m,g.m,[_.b]),o._13(4608,g.l,g.l,[g.d,g.m]),o._13(6144,o.F,null,[g.l]),o._13(6144,g.p,null,[g.m]),o._13(4608,o.L,o.L,[o.z]),o._13(4608,g.g,g.g,[_.b]),o._13(4608,g.i,g.i,[_.b]),o._13(4608,h,h,[]),o._13(512,_.a,_.a,[]),o._13(1024,o.l,g.q,[]),o._13(1024,o.b,function(t,n){return[g.r(t,n)]},[[2,g.h],[2,o.y]]),o._13(512,o.c,o.c,[[2,o.b]]),o._13(131584,o._2,o._2,[o.z,o.X,o.r,o.l,o.i,o.c]),o._13(2048,o.e,null,[o._2]),o._13(512,o.d,o.d,[o.e]),o._13(512,g.a,g.a,[[3,g.a]]),o._13(512,r,r,[])])});u.production&&Object(o.R)(),Object(g.j)().bootstrapModuleFactory(v).catch(function(t){return console.log(t)})},gFIY:function(t,n){function e(t){return Promise.resolve().then(function(){throw new Error("Cannot find module '"+t+"'.")})}e.keys=function(){return[]},e.resolve=e,t.exports=e,e.id="gFIY"}},[0]);